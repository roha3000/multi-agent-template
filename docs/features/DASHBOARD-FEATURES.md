# Enhanced Dashboard Features

## Overview

The enhanced dashboard now provides complete visibility and control over the continuous loop system with:

âœ… **Real-time task tracking** - See what's complete, in-progress, and pending
âœ… **Artifact management** - View and launch files created during the session
âœ… **Interactive config toggles** - Enable/disable features from the dashboard
âœ… **Live metrics** - All limits, usage, and progress updated every 2 seconds
âœ… **Full control** - Checkpoint and wrap-up buttons

## Dashboard Sections

### 1. ğŸ“Š Context Window

Shows current context window usage with visual progress bar:
- **Current usage**: Tokens consumed so far
- **Status indicators**: OK (green) â†’ Warning (orange) â†’ Critical (red) â†’ Emergency (dark red)
- **Next checkpoint**: Tokens remaining until next checkpoint

### 2. ğŸŒ API Limits

Displays Claude API rate limits (if enabled):
- **Requests/minute**: Current usage vs limit
- **Requests/hour**: Hourly tracking
- **Requests/day**: Daily quota
- **Plan shown**: Free, Pro, or Team

### 3. ğŸ’° Token Usage

Real-time cost tracking:
- **Input tokens**: Tokens sent to Claude
- **Output tokens**: Tokens generated by Claude
- **Total cost**: Accumulated session cost
- **Cache savings**: Money saved through prompt caching

### 4. âš™ï¸ Current Execution

Shows what Claude is working on right now:
- **Phase**: Research, Planning, Design, Implementation, etc.
- **Agent**: Which agent is active
- **Task**: Current task description
- **Duration**: How long the task has been running

### 5. ğŸ“‹ Execution Plan

**Full task list with real-time updates:**

```
âœ… Task 1: Completed task          100%
âœ… Task 2: Another done task       100%
ğŸ”„ Task 3: Currently working       75%  â† Pulsing animation
â³ Task 4: Pending task             0%
â³ Task 5: Waiting to start         0%
```

**Status indicators:**
- âœ… **Green** - Completed
- ğŸ”„ **Blue** (pulsing) - In Progress
- â³ **Gray** - Pending

### 6. ğŸ“¦ Session Artifacts

**Track every file created:**

Each artifact shows:
- **Icon**: Visual indicator of file type
- **Name**: File name/path
- **Type**: file, code, document, data, image
- **Created**: Timestamp
- **Phase**: Which phase created it
- **Actions**:
  - ğŸ‘ï¸ **View**: Open file content in modal
  - ğŸš€ **Launch**: Open in system editor

**Example:**
```
ğŸ“„ dashboard-manager.js
   file â€¢ 12/13/2025, 3:30 PM â€¢ implementation
   [ğŸ‘ï¸ View] [ğŸš€ Launch]

ğŸ’» checkpoint-optimizer.js
   code â€¢ 12/13/2025, 3:45 PM â€¢ implementation
   [ğŸ‘ï¸ View] [ğŸš€ Launch]
```

### 7. âš™ï¸ Configuration

**Interactive toggles to enable/disable features:**

Each toggle shows:
- **Feature name**: What it controls
- **Description**: What it does
- **Toggle switch**: Click to enable/disable

**Available Toggles:**

| Feature | Description | Default |
|---------|-------------|---------|
| **API Limit Tracking** | Monitor and enforce Claude API rate limits | ON |
| **Context Window Monitoring** | Track context usage and trigger checkpoints | ON |
| **Cost Budget Tracking** | Monitor token costs against budgets | ON |
| **Intelligent Checkpoint Learning** | Adapt checkpoint timing based on history | ON |
| **Compaction Detection** | Detect and auto-adjust when context is forced | ON |

**Toggle behavior:**
- âœ… Green = Enabled
- âšª Gray = Disabled
- Changes save immediately to `.claude/settings.local.json`
- System applies changes in real-time

### 8. ğŸ”” Recent Events

Timeline of recent activities:
```
3:45:32 PM  âœ… Execution completed
3:45:15 PM  ğŸ”„ Task started: Implement dashboard
3:45:00 PM  âš ï¸  Warning: 80% context threshold reached
3:44:45 PM  ğŸ’¾ Checkpoint saved (checkpoint-123)
```

**Event types:**
- â–¶ï¸ Start - Execution started
- âœ… Success - Completed successfully
- âŒ Error - Failure occurred
- âš ï¸ Warning - Warning issued
- â„¹ï¸ Info - Informational message
- ğŸ’¾ Checkpoint - State saved

## Interactive Features

### Viewing Artifacts

**Click "ğŸ‘ï¸ View" on any artifact:**

1. Modal opens with full file content
2. Syntax highlighting for code files
3. Scrollable for large files
4. Close with "âœ• Close" button

**Example:**
```javascript
// File content displayed in modal
class DashboardManager {
  constructor() {
    // ...
  }
}
```

### Toggling Configuration

**Click any toggle switch:**

1. Switch animates (gray â†’ green or green â†’ gray)
2. Configuration saves to file immediately
3. System applies change in real-time
4. Event appears in timeline: "Configuration updated"

**Example:**
```
Before: âšª API Limit Tracking [Disabled]
Click!
After:  âœ… API Limit Tracking [Enabled]

Event: "â„¹ï¸ Configuration updated: apiLimitTracking.enabled = true"
```

### Control Buttons

**Top-right header buttons:**

**ğŸ’¾ Checkpoint**
- Triggers immediate checkpoint
- Saves all state to disk
- Useful before risky operations

**ğŸ›‘ Wrap Up**
- Initiates graceful wrap-up
- Completes current task
- Saves state and generates summary
- Shows confirmation dialog first

## Real-Time Updates

Dashboard updates automatically via **Server-Sent Events (SSE)**:

- **Update interval**: Every 2 seconds
- **No refresh needed**: Changes appear instantly
- **Connection status**: Green dot = connected

**What updates in real-time:**
- âœ… Token usage
- âœ… API limit consumption
- âœ… Context window percentage
- âœ… Task progress (0% â†’ 25% â†’ 50% â†’ 75% â†’ 100%)
- âœ… New artifacts added
- âœ… Configuration changes
- âœ… Events timeline

## API Endpoints

The dashboard exposes several REST APIs:

### GET /api/state
Returns complete dashboard state
```json
{
  "session": { "id": "...", "status": "running" },
  "context": { "current": 120000, "limit": 200000 },
  "plan": { "tasks": [...], "completedTasks": 5 },
  "artifacts": [...],
  "config": {...},
  "events": [...]
}
```

### GET /api/artifacts
Returns list of all session artifacts
```json
[
  {
    "id": "artifact-123",
    "name": "dashboard-manager.js",
    "path": ".claude/core/dashboard-manager.js",
    "type": "code",
    "created": 1702417800000,
    "phase": "implementation"
  }
]
```

### GET /api/file?filePath=...
Returns file content
```json
{
  "path": ".claude/core/dashboard-manager.js",
  "content": "class DashboardManager {...}",
  "size": 15234,
  "modified": "2025-12-13T15:30:00Z"
}
```

### POST /api/config
Update configuration setting
```json
{
  "path": "apiLimitTracking.enabled",
  "value": true
}
```

Response:
```json
{
  "success": true,
  "path": "apiLimitTracking.enabled",
  "value": true,
  "oldValue": false
}
```

## Usage Examples

### Example 1: Monitoring Long Task

```
1. Task starts: "Implement continuous loop system"
   - Status: ğŸ”„ In Progress
   - Progress: 0%

2. Context grows: 50K â†’ 100K â†’ 150K tokens
   - Dashboard shows: 75% context used
   - Status: OK (green)

3. Warning triggered at 160K tokens
   - Status: âš ï¸ WARNING (orange)
   - Message: "Approaching checkpoint threshold"

4. Checkpoint at 170K tokens
   - Event: "ğŸ’¾ Checkpoint saved"
   - Task status: Still in progress (preserved)
   - Context reset: Back to ~20K

5. Task completes
   - Status: âœ… Completed
   - Progress: 100%
   - Artifact added: continuous-loop-orchestrator.js
```

### Example 2: Artifact Viewing

```
1. Claude creates file: "checkpoint-optimizer.js"
   - Appears in artifacts list immediately
   - Shows: ğŸ’» code â€¢ implementation

2. Click "ğŸ‘ï¸ View"
   - Modal opens
   - Full source code displayed
   - Can scroll through 500+ lines

3. Review code
   - See all functions
   - Check implementation details
   - Verify quality

4. Close modal
   - Continue monitoring
   - File still in artifacts list
```

### Example 3: Toggling Features

```
Scenario: Reduce costs by disabling API limit tracking

1. Current state:
   - API tracking: âœ… Enabled
   - Cost: $15.92
   - API calls: 234/1000 tracked

2. Click toggle for "API Limit Tracking"
   - Switch: Green â†’ Gray
   - Config saved: apiLimitTracking.enabled = false

3. Result:
   - API section shows: "Disabled"
   - Tracking stops (saves processing)
   - Other features still active

4. Re-enable later:
   - Click toggle again
   - Tracking resumes immediately
```

## Keyboard Shortcuts

(Future enhancement)

- `Ctrl+K`: Trigger checkpoint
- `Ctrl+W`: Initiate wrap-up
- `Ctrl+R`: Refresh metrics
- `Esc`: Close modal

## Mobile Responsiveness

Dashboard adapts to screen sizes:
- **Desktop**: 2-column grid layout
- **Tablet**: 1-column layout
- **Mobile**: Stacked cards, full-width

## Troubleshooting

### Dashboard not updating

**Check:**
1. Browser console for errors
2. SSE connection (green dot)
3. Backend running on port 3030

**Fix:**
```bash
# Restart dashboard
node .claude/core/dashboard-manager.js
```

### Config toggle not saving

**Check:**
1. File permissions on `.claude/settings.local.json`
2. Browser console for 403/500 errors

**Fix:**
```bash
# Check file exists and is writable
ls -la .claude/settings.local.json
chmod 644 .claude/settings.local.json
```

### File viewer shows "Access denied"

**Cause:** Security restriction - can only view files in project directory

**Solution:** File must be within project root

## Security

### File Access Restrictions

- âœ… Only files in project directory can be viewed
- âŒ Cannot access system files (/etc/passwd, etc.)
- âŒ Cannot access parent directories (../)
- âœ… Absolute paths resolved and validated

### Configuration Changes

- âœ… Only `continuousLoop` section can be modified
- âŒ Cannot modify other settings sections
- âœ… Changes written atomically
- âœ… Invalid values rejected

## Performance

**Dashboard is highly optimized:**

- **Memory**: <50MB for full dashboard
- **CPU**: <1% during updates
- **Network**: ~5KB per update (SSE compressed)
- **Update latency**: <50ms from event to display

**Handles large sessions:**
- âœ… 1000+ tasks
- âœ… 500+ artifacts
- âœ… 10,000+ events (displays last 50)

## OTLP Telemetry Integration

The dashboard includes an **OpenTelemetry Protocol (OTLP) receiver** that accepts telemetry from Claude Code CLI sessions.

### How It Works

1. **Claude Code** exports metrics via OTLP (tokens, costs, requests)
2. **Dashboard receiver** (port 4318) accepts and processes metrics
3. **UsageLimitTracker** updates dashboard usage display
4. **Real-time updates** via SSE to all connected clients

### Configuration

Add to `~/.claude/settings.json`:

```json
{
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1",
    "OTEL_METRICS_EXPORTER": "otlp",
    "OTEL_LOGS_EXPORTER": "otlp",
    "OTEL_EXPORTER_OTLP_PROTOCOL": "http/json",
    "OTEL_EXPORTER_OTLP_ENDPOINT": "http://localhost:4318"
  }
}
```

**Environment Variables:**
| Variable | Value | Description |
|----------|-------|-------------|
| `CLAUDE_CODE_ENABLE_TELEMETRY` | `1` | Enable telemetry |
| `OTEL_METRICS_EXPORTER` | `otlp` | Use OTLP for metrics |
| `OTEL_LOGS_EXPORTER` | `otlp` | Use OTLP for logs |
| `OTEL_EXPORTER_OTLP_PROTOCOL` | `http/json` | JSON format (required) |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | `http://localhost:4318` | Dashboard receiver |

### Dashboard Setup

Enable OTLP in the dashboard's `.env` file:

```bash
ENABLE_OTLP=true
OTLP_PORT=4318  # optional, default is 4318
```

### OTLP Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/v1/metrics` | POST | Receive OTLP metrics (JSON format) |
| `/health` | GET | Receiver health check |

### Metrics Received

| Metric | Type | Description |
|--------|------|-------------|
| `claude_code.token.usage` | Counter | Token consumption by type |
| `claude_code.request.duration` | Histogram | API request latency |
| `claude_code.request.count` | Counter | Total API requests |
| `claude_code.cost.usage` | Counter | Session cost in USD |

### Testing OTLP

```bash
# Check receiver health
curl http://localhost:4318/health

# Send test metric
curl -X POST http://localhost:4318/v1/metrics \
  -H "Content-Type: application/json" \
  -d '{
    "resourceMetrics": [{
      "scopeMetrics": [{
        "metrics": [{
          "name": "claude_code.token.usage",
          "sum": {
            "dataPoints": [{
              "asInt": 1000,
              "attributes": [
                {"key": "model", "value": {"stringValue": "claude-opus-4-5"}},
                {"key": "type", "value": {"stringValue": "input"}}
              ]
            }]
          }
        }]
      }]
    }]
  }'
```

### Troubleshooting

**OTLP receiver not starting:**
- Check `ENABLE_OTLP=true` in `.env`
- Verify port 4318 is not in use
- Check dashboard logs for initialization errors

**Metrics not appearing:**
- Verify Claude Code settings have telemetry enabled
- Ensure `http/json` protocol (protobuf not supported)
- Check dashboard logs for received metrics

---

**Access Dashboard:** http://localhost:3033
**OTLP Receiver:** http://localhost:4318
**Last Updated:** 2025-12-31
**Version:** 2.1.0 (OTLP Integration)
